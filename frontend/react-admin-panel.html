<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bunyod-Tour React Admin Panel</title>
    
    <!-- Material-UI Icons and Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    
    <style>
        body {
            margin: 0;
            font-family: 'Roboto', sans-serif;
            background-color: #f5f5f5;
        }
        .json-editor {
            display: flex;
            flex-direction: column;
            gap: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 16px;
            background-color: #f9f9f9;
            margin: 8px 0;
        }
        .json-field {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .json-field label {
            min-width: 40px;
            font-weight: bold;
            color: #666;
            font-size: 0.875rem;
        }
        .json-field input, .json-field textarea {
            flex: 1;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.875rem;
        }
        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }
        .admin-container {
            height: 100vh;
            overflow: hidden;
        }
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .stat-label {
            color: #666;
            font-size: 1rem;
        }
        .simple-admin-layout {
            display: flex;
            height: 100vh;
        }
        .sidebar {
            width: 250px;
            background: #1976d2;
            color: white;
            padding: 20px 0;
        }
        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        .sidebar-menu {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .sidebar-menu li {
            padding: 12px 20px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .sidebar-menu li:hover {
            background-color: rgba(255,255,255,0.1);
        }
        .sidebar-menu li.active {
            background-color: rgba(255,255,255,0.2);
        }
        .main-content {
            flex: 1;
            overflow-y: auto;
            background: #f5f5f5;
        }
        .content-header {
            background: white;
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .content-body {
            padding: 20px;
        }
        .login-form {
            max-width: 400px;
            margin: 100px auto;
            padding: 40px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s;
        }
        .btn-primary {
            background: #1976d2;
            color: white;
        }
        .btn-primary:hover {
            background: #1565c0;
        }
        .btn-success {
            background: #4caf50;
            color: white;
        }
        .btn-danger {
            background: #f44336;
            color: white;
        }
        .table {
            width: 100%;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .table th, .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        .table th {
            background: #f5f5f5;
            font-weight: 500;
        }
        .actions {
            display: flex;
            gap: 8px;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .error {
            color: #f44336;
            font-size: 14px;
            margin-top: 5px;
        }
        .success {
            color: #4caf50;
            font-size: 14px;
            margin-top: 5px;
        }
        .multilingual-field {
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 16px;
            background: #fafafa;
            margin-bottom: 16px;
        }
        .multilingual-title {
            font-weight: 500;
            margin-bottom: 12px;
            color: #333;
        }
        .lang-input {
            margin-bottom: 12px;
        }
        .lang-label {
            display: inline-block;
            width: 40px;
            font-weight: bold;
            color: #666;
            margin-right: 8px;
        }
        .lang-field {
            width: calc(100% - 60px);
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Axios for API calls -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // API Configuration
        const API_BASE = window.location.hostname.includes('replit.dev') 
            ? `https://${window.location.hostname}:5000/api`
            : `${window.location.protocol}//${window.location.hostname}:5000/api`;

        console.log('API_BASE:', API_BASE);

        // Authentication service
        const authService = {
            login: async (username, password) => {
                try {
                    const response = await axios.post(`${API_BASE}/admin/login`, {
                        username,
                        password
                    });
                    
                    if (response.data.success) {
                        const { token, admin } = response.data.data;
                        localStorage.setItem('authToken', token);
                        localStorage.setItem('user', JSON.stringify(admin));
                        return { success: true, data: response.data.data };
                    }
                    return { success: false, error: 'Invalid credentials' };
                } catch (error) {
                    console.error('Login error:', error);
                    return { success: false, error: 'Login failed' };
                }
            },
            logout: () => {
                localStorage.removeItem('authToken');
                localStorage.removeItem('user');
            },
            isAuthenticated: () => {
                return !!localStorage.getItem('authToken');
            },
            getUser: () => {
                const user = localStorage.getItem('user');
                return user ? JSON.parse(user) : null;
            },
            getToken: () => {
                return localStorage.getItem('authToken');
            }
        };

        // API service
        const apiService = {
            makeRequest: async (method, url, data = null) => {
                const token = authService.getToken();
                const config = {
                    method,
                    url: `${API_BASE}${url}`,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };
                
                if (token) {
                    config.headers.Authorization = `Bearer ${token}`;
                }
                
                if (data) {
                    config.data = data;
                }
                
                try {
                    const response = await axios(config);
                    return { success: true, data: response.data };
                } catch (error) {
                    if (error.response?.status === 401) {
                        authService.logout();
                        window.location.reload();
                    }
                    return { 
                        success: false, 
                        error: error.response?.data?.message || error.message 
                    };
                }
            },
            
            // Specific endpoints
            getStats: async () => {
                try {
                    const response = await apiService.makeRequest('GET', '/sqlite/stats');
                    return response.success ? response.data.data : {};
                } catch (error) {
                    return {};
                }
            },
            
            getTours: () => apiService.makeRequest('GET', '/tours'),
            getOrders: () => apiService.makeRequest('GET', '/orders'),
            getCustomers: () => apiService.makeRequest('GET', '/customers'),
            getHotels: () => apiService.makeRequest('GET', '/hotels'),
            getGuides: () => apiService.makeRequest('GET', '/guides'),
            getCategories: () => apiService.makeRequest('GET', '/categories'),
            getNews: () => apiService.makeRequest('GET', '/news'),
            getContentBlocks: () => apiService.makeRequest('GET', '/cms/content-blocks'),
            
            createTour: (data) => apiService.makeRequest('POST', '/tours', data),
            updateTour: (id, data) => apiService.makeRequest('PUT', `/tours/${id}`, data),
            deleteTour: (id) => apiService.makeRequest('DELETE', `/tours/${id}`),
            
            createHotel: (data) => apiService.makeRequest('POST', '/hotels', data),
            updateHotel: (id, data) => apiService.makeRequest('PUT', `/hotels/${id}`, data),
            deleteHotel: (id) => apiService.makeRequest('DELETE', `/hotels/${id}`),
            
            updateOrderStatus: (id, status) => apiService.makeRequest('PUT', `/orders/${id}/status`, { status })
        };

        // Helper functions for multilingual fields
        const parseMultilingualField = (value) => {
            if (!value) return { ru: '', en: '', tj: '' };
            if (typeof value === 'string') {
                try {
                    return JSON.parse(value);
                } catch {
                    return { ru: value, en: '', tj: '' };
                }
            }
            return value;
        };

        const serializeMultilingualField = (value) => {
            if (typeof value === 'object') {
                return JSON.stringify(value);
            }
            return value;
        };

        // Multilingual Input Component
        const MultilingualInput = ({ label, value, onChange, multiline = false }) => {
            const [localValue, setLocalValue] = useState({ ru: '', en: '', tj: '' });

            useEffect(() => {
                setLocalValue(parseMultilingualField(value));
            }, [value]);

            const handleChange = (lang, newValue) => {
                const updatedValue = { ...localValue, [lang]: newValue };
                setLocalValue(updatedValue);
                if (onChange) {
                    onChange(serializeMultilingualField(updatedValue));
                }
            };

            return (
                <div className="multilingual-field">
                    <div className="multilingual-title">{label}</div>
                    {['ru', 'en', 'tj'].map(lang => (
                        <div key={lang} className="lang-input">
                            <span className="lang-label">{lang.toUpperCase()}:</span>
                            {multiline ? (
                                <textarea
                                    className="lang-field"
                                    rows="3"
                                    value={localValue[lang] || ''}
                                    onChange={(e) => handleChange(lang, e.target.value)}
                                />
                            ) : (
                                <input
                                    className="lang-field"
                                    value={localValue[lang] || ''}
                                    onChange={(e) => handleChange(lang, e.target.value)}
                                />
                            )}
                        </div>
                    ))}
                </div>
            );
        };

        // Login Component
        const LoginForm = ({ onLogin }) => {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');
                
                const result = await authService.login(username, password);
                if (result.success) {
                    onLogin(result.data);
                } else {
                    setError(result.error);
                }
                setLoading(false);
            };

            return (
                <div className="login-form">
                    <h2 style={{ textAlign: 'center', marginBottom: '30px' }}>
                        Bunyod-Tour Admin Panel
                    </h2>
                    <form onSubmit={handleSubmit}>
                        <div className="form-group">
                            <label>Username</label>
                            <input
                                type="text"
                                value={username}
                                onChange={(e) => setUsername(e.target.value)}
                                required
                                disabled={loading}
                            />
                        </div>
                        <div className="form-group">
                            <label>Password</label>
                            <input
                                type="password"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                required
                                disabled={loading}
                            />
                        </div>
                        {error && <div className="error">{error}</div>}
                        <button
                            type="submit"
                            className="btn btn-primary"
                            style={{ width: '100%', marginTop: '20px' }}
                            disabled={loading}
                        >
                            {loading ? 'Signing in...' : 'Sign In'}
                        </button>
                    </form>
                </div>
            );
        };

        // Dashboard Component
        const Dashboard = () => {
            const [stats, setStats] = useState({});
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const fetchStats = async () => {
                    const data = await apiService.getStats();
                    setStats(data);
                    setLoading(false);
                };
                fetchStats();
            }, []);

            if (loading) {
                return <div className="loading-container">Loading statistics...</div>;
            }

            return (
                <div>
                    <div className="content-header">
                        <h2>Dashboard</h2>
                    </div>
                    <div className="content-body">
                        <div className="dashboard-stats">
                            <div className="stat-card">
                                <div className="stat-number" style={{ color: '#3f51b5' }}>
                                    {stats.tours || 0}
                                </div>
                                <div className="stat-label">Total Tours</div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-number" style={{ color: '#4caf50' }}>
                                    {stats.bookings || 0}
                                </div>
                                <div className="stat-label">Total Bookings</div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-number" style={{ color: '#ff9800' }}>
                                    {stats.users || 0}
                                </div>
                                <div className="stat-label">Total Users</div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-number" style={{ color: '#f44336' }}>
                                    {stats.promotions || 0}
                                </div>
                                <div className="stat-label">Active Promotions</div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Tours Management
        const ToursManager = () => {
            const [tours, setTours] = useState([]);
            const [loading, setLoading] = useState(true);
            const [showModal, setShowModal] = useState(false);
            const [editingTour, setEditingTour] = useState(null);
            const [formData, setFormData] = useState({
                title: '',
                description: '',
                shortDesc: '',
                duration: '',
                price: '',
                country: '',
                city: '',
                categoryId: 1,
                isActive: true
            });

            useEffect(() => {
                fetchTours();
            }, []);

            const fetchTours = async () => {
                setLoading(true);
                const result = await apiService.getTours();
                if (result.success) {
                    setTours(result.data.data || []);
                }
                setLoading(false);
            };

            const handleSave = async () => {
                const tourData = { ...formData };
                
                // Serialize multilingual fields
                ['title', 'description', 'shortDesc'].forEach(field => {
                    if (tourData[field] && typeof tourData[field] === 'string') {
                        try {
                            JSON.parse(tourData[field]);
                        } catch {
                            // If not valid JSON, create multilingual object
                            tourData[field] = JSON.stringify({
                                ru: tourData[field],
                                en: '',
                                tj: ''
                            });
                        }
                    }
                });

                let result;
                if (editingTour) {
                    result = await apiService.updateTour(editingTour.id, tourData);
                } else {
                    result = await apiService.createTour(tourData);
                }

                if (result.success) {
                    fetchTours();
                    setShowModal(false);
                    setEditingTour(null);
                    setFormData({
                        title: '',
                        description: '',
                        shortDesc: '',
                        duration: '',
                        price: '',
                        country: '',
                        city: '',
                        categoryId: 1,
                        isActive: true
                    });
                }
            };

            const handleEdit = (tour) => {
                setEditingTour(tour);
                setFormData({
                    ...tour,
                    title: tour.title || '',
                    description: tour.description || '',
                    shortDesc: tour.shortDesc || ''
                });
                setShowModal(true);
            };

            const handleDelete = async (id) => {
                if (confirm('Are you sure you want to delete this tour?')) {
                    await apiService.deleteTour(id);
                    fetchTours();
                }
            };

            const displayMultilingualField = (value) => {
                const parsed = parseMultilingualField(value);
                return parsed.ru || parsed.en || parsed.tj || '';
            };

            if (loading) {
                return <div className="loading-container">Loading tours...</div>;
            }

            return (
                <div>
                    <div className="content-header">
                        <h2>Tours Management</h2>
                        <button 
                            className="btn btn-primary"
                            onClick={() => {
                                setEditingTour(null);
                                setFormData({
                                    title: '',
                                    description: '',
                                    shortDesc: '',
                                    duration: '',
                                    price: '',
                                    country: '',
                                    city: '',
                                    categoryId: 1,
                                    isActive: true
                                });
                                setShowModal(true);
                            }}
                        >
                            Add Tour
                        </button>
                    </div>
                    <div className="content-body">
                        <table className="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Title</th>
                                    <th>Country</th>
                                    <th>Price</th>
                                    <th>Duration</th>
                                    <th>Active</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {tours.map(tour => (
                                    <tr key={tour.id}>
                                        <td>{tour.id}</td>
                                        <td>{displayMultilingualField(tour.title)}</td>
                                        <td>{tour.country}</td>
                                        <td>{tour.price}</td>
                                        <td>{tour.duration}</td>
                                        <td>{tour.isActive ? 'Yes' : 'No'}</td>
                                        <td>
                                            <div className="actions">
                                                <button 
                                                    className="btn btn-primary"
                                                    onClick={() => handleEdit(tour)}
                                                >
                                                    Edit
                                                </button>
                                                <button 
                                                    className="btn btn-danger"
                                                    onClick={() => handleDelete(tour.id)}
                                                >
                                                    Delete
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    {showModal && (
                        <div className="modal">
                            <div className="modal-content">
                                <h3>{editingTour ? 'Edit Tour' : 'Add Tour'}</h3>
                                
                                <MultilingualInput
                                    label="Title"
                                    value={formData.title}
                                    onChange={(value) => setFormData({...formData, title: value})}
                                />

                                <MultilingualInput
                                    label="Description"
                                    value={formData.description}
                                    onChange={(value) => setFormData({...formData, description: value})}
                                    multiline
                                />

                                <MultilingualInput
                                    label="Short Description"
                                    value={formData.shortDesc}
                                    onChange={(value) => setFormData({...formData, shortDesc: value})}
                                    multiline
                                />

                                <div className="form-group">
                                    <label>Duration</label>
                                    <input
                                        type="text"
                                        value={formData.duration}
                                        onChange={(e) => setFormData({...formData, duration: e.target.value})}
                                    />
                                </div>

                                <div className="form-group">
                                    <label>Price</label>
                                    <input
                                        type="text"
                                        value={formData.price}
                                        onChange={(e) => setFormData({...formData, price: e.target.value})}
                                    />
                                </div>

                                <div className="form-group">
                                    <label>Country</label>
                                    <input
                                        type="text"
                                        value={formData.country}
                                        onChange={(e) => setFormData({...formData, country: e.target.value})}
                                    />
                                </div>

                                <div className="form-group">
                                    <label>City</label>
                                    <input
                                        type="text"
                                        value={formData.city}
                                        onChange={(e) => setFormData({...formData, city: e.target.value})}
                                    />
                                </div>

                                <div className="form-group">
                                    <label>
                                        <input
                                            type="checkbox"
                                            checked={formData.isActive}
                                            onChange={(e) => setFormData({...formData, isActive: e.target.checked})}
                                        />
                                        Active
                                    </label>
                                </div>

                                <div className="actions" style={{ marginTop: '20px' }}>
                                    <button className="btn btn-success" onClick={handleSave}>
                                        Save
                                    </button>
                                    <button 
                                        className="btn"
                                        onClick={() => setShowModal(false)}
                                        style={{ marginLeft: '10px' }}
                                    >
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Orders Management
        const OrdersManager = () => {
            const [orders, setOrders] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                fetchOrders();
            }, []);

            const fetchOrders = async () => {
                setLoading(true);
                const result = await apiService.getOrders();
                if (result.success) {
                    setOrders(result.data.data || []);
                }
                setLoading(false);
            };

            const updateStatus = async (id, status) => {
                const result = await apiService.updateOrderStatus(id, status);
                if (result.success) {
                    fetchOrders();
                }
            };

            if (loading) {
                return <div className="loading-container">Loading orders...</div>;
            }

            return (
                <div>
                    <div className="content-header">
                        <h2>Orders Management</h2>
                    </div>
                    <div className="content-body">
                        <table className="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Order Number</th>
                                    <th>Tour Date</th>
                                    <th>Status</th>
                                    <th>Payment Status</th>
                                    <th>Total Amount</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {orders.map(order => (
                                    <tr key={order.id}>
                                        <td>{order.id}</td>
                                        <td>{order.orderNumber}</td>
                                        <td>{order.tourDate}</td>
                                        <td>
                                            <select 
                                                value={order.status}
                                                onChange={(e) => updateStatus(order.id, e.target.value)}
                                            >
                                                <option value="pending">Pending</option>
                                                <option value="confirmed">Confirmed</option>
                                                <option value="paid">Paid</option>
                                                <option value="cancelled">Cancelled</option>
                                                <option value="completed">Completed</option>
                                            </select>
                                        </td>
                                        <td>{order.paymentStatus}</td>
                                        <td>${order.totalAmount}</td>
                                        <td>
                                            <button className="btn btn-primary">View</button>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        // Simple list component for other resources
        const SimpleList = ({ title, resource, fetchData, columns }) => {
            const [data, setData] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                fetchList();
            }, []);

            const fetchList = async () => {
                setLoading(true);
                const result = await fetchData();
                if (result.success) {
                    setData(result.data.data || []);
                }
                setLoading(false);
            };

            if (loading) {
                return <div className="loading-container">Loading {title.toLowerCase()}...</div>;
            }

            return (
                <div>
                    <div className="content-header">
                        <h2>{title}</h2>
                    </div>
                    <div className="content-body">
                        <table className="table">
                            <thead>
                                <tr>
                                    {columns.map(col => (
                                        <th key={col.key}>{col.label}</th>
                                    ))}
                                </tr>
                            </thead>
                            <tbody>
                                {data.map(item => (
                                    <tr key={item.id}>
                                        {columns.map(col => (
                                            <td key={col.key}>
                                                {col.render ? col.render(item) : item[col.key]}
                                            </td>
                                        ))}
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        // Main Admin Component
        const AdminPanel = () => {
            const [user, setUser] = useState(null);
            const [currentPage, setCurrentPage] = useState('dashboard');
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                checkAuth();
            }, []);

            const checkAuth = async () => {
                if (authService.isAuthenticated()) {
                    setUser(authService.getUser());
                }
                setLoading(false);
            };

            const handleLogin = (userData) => {
                setUser(userData.admin);
            };

            const handleLogout = () => {
                authService.logout();
                setUser(null);
                setCurrentPage('dashboard');
            };

            const menuItems = [
                { key: 'dashboard', label: 'Dashboard', icon: 'ðŸ ' },
                { key: 'tours', label: 'Tours', icon: 'ðŸ—ºï¸' },
                { key: 'orders', label: 'Orders', icon: 'ðŸ“‹' },
                { key: 'customers', label: 'Customers', icon: 'ðŸ‘¥' },
                { key: 'hotels', label: 'Hotels', icon: 'ðŸ¨' },
                { key: 'guides', label: 'Guides', icon: 'ðŸ‘¨â€ðŸ¦±' },
                { key: 'categories', label: 'Categories', icon: 'ðŸ“‚' },
                { key: 'news', label: 'News', icon: 'ðŸ“°' },
                { key: 'cms', label: 'CMS Content', icon: 'ðŸ“' }
            ];

            const renderContent = () => {
                switch (currentPage) {
                    case 'dashboard':
                        return <Dashboard />;
                    case 'tours':
                        return <ToursManager />;
                    case 'orders':
                        return <OrdersManager />;
                    case 'customers':
                        return <SimpleList 
                            title="Customers" 
                            resource="customers"
                            fetchData={apiService.getCustomers}
                            columns={[
                                { key: 'id', label: 'ID' },
                                { key: 'fullName', label: 'Name' },
                                { key: 'email', label: 'Email' },
                                { key: 'phone', label: 'Phone' },
                                { key: 'createdAt', label: 'Created', render: (item) => new Date(item.createdAt).toLocaleDateString() }
                            ]}
                        />;
                    case 'hotels':
                        return <SimpleList 
                            title="Hotels" 
                            resource="hotels"
                            fetchData={apiService.getHotels}
                            columns={[
                                { key: 'id', label: 'ID' },
                                { key: 'name', label: 'Name', render: (item) => {
                                    const parsed = parseMultilingualField(item.name);
                                    return parsed.ru || parsed.en || parsed.tj || '';
                                }},
                                { key: 'country', label: 'Country' },
                                { key: 'city', label: 'City' },
                                { key: 'stars', label: 'Stars' },
                                { key: 'rating', label: 'Rating' }
                            ]}
                        />;
                    case 'guides':
                        return <SimpleList 
                            title="Guides" 
                            resource="guides"
                            fetchData={apiService.getGuides}
                            columns={[
                                { key: 'id', label: 'ID' },
                                { key: 'name', label: 'Name', render: (item) => {
                                    const parsed = parseMultilingualField(item.name);
                                    return parsed.ru || parsed.en || parsed.tj || '';
                                }},
                                { key: 'experience', label: 'Experience' },
                                { key: 'rating', label: 'Rating' },
                                { key: 'isActive', label: 'Active', render: (item) => item.isActive ? 'Yes' : 'No' }
                            ]}
                        />;
                    case 'categories':
                        return <SimpleList 
                            title="Categories" 
                            resource="categories"
                            fetchData={apiService.getCategories}
                            columns={[
                                { key: 'id', label: 'ID' },
                                { key: 'name', label: 'Name', render: (item) => {
                                    const parsed = parseMultilingualField(item.name);
                                    return parsed.ru || parsed.en || parsed.tj || '';
                                }}
                            ]}
                        />;
                    case 'news':
                        return <SimpleList 
                            title="News & Promotions" 
                            resource="news"
                            fetchData={apiService.getNews}
                            columns={[
                                { key: 'id', label: 'ID' },
                                { key: 'title', label: 'Title', render: (item) => {
                                    const parsed = parseMultilingualField(item.title);
                                    return parsed.ru || parsed.en || parsed.tj || '';
                                }},
                                { key: 'category', label: 'Category' },
                                { key: 'author', label: 'Author' },
                                { key: 'isPublished', label: 'Published', render: (item) => item.isPublished ? 'Yes' : 'No' }
                            ]}
                        />;
                    case 'cms':
                        return <SimpleList 
                            title="CMS Content Blocks" 
                            resource="cms"
                            fetchData={apiService.getContentBlocks}
                            columns={[
                                { key: 'id', label: 'ID' },
                                { key: 'key', label: 'Key' },
                                { key: 'title', label: 'Title', render: (item) => {
                                    const parsed = parseMultilingualField(item.title);
                                    return parsed.ru || parsed.en || parsed.tj || '';
                                }},
                                { key: 'section', label: 'Section' },
                                { key: 'type', label: 'Type' }
                            ]}
                        />;
                    default:
                        return <Dashboard />;
                }
            };

            if (loading) {
                return <div className="loading-container">Loading...</div>;
            }

            if (!user) {
                return <LoginForm onLogin={handleLogin} />;
            }

            return (
                <div className="simple-admin-layout">
                    <div className="sidebar">
                        <div className="sidebar-header">
                            <h3>Admin Panel</h3>
                            <p>Welcome, {user.fullName}</p>
                        </div>
                        <ul className="sidebar-menu">
                            {menuItems.map(item => (
                                <li 
                                    key={item.key}
                                    className={currentPage === item.key ? 'active' : ''}
                                    onClick={() => setCurrentPage(item.key)}
                                >
                                    {item.icon} {item.label}
                                </li>
                            ))}
                            <li onClick={handleLogout} style={{ borderTop: '1px solid rgba(255,255,255,0.1)', marginTop: '20px', paddingTop: '20px' }}>
                                ðŸšª Logout
                            </li>
                        </ul>
                    </div>
                    <div className="main-content">
                        {renderContent()}
                    </div>
                </div>
            );
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AdminPanel />);
    </script>
</body>
</html>