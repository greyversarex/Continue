<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="guides.page_title">Наши тургиды - Bunyod-Tour</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/public/js/replit-cache.js"></script>
    <script src="/public/js/i18n.js"></script>
    <script src="/public/js/layout-loader.js"></script>
</head>
<body class="bg-gray-50">
    <!-- Динамический контейнер для header -->
    <div id="header-container"></div>

    <!-- Главная секция -->
    <section class="py-16 bg-white">
        <div class="container mx-auto px-6">
            <div class="text-center mb-12">
                <h1 class="text-4xl font-bold text-gray-800 mb-4" data-translate="guides.title">НАШИ ТУРГИДЫ</h1>
                <p class="text-lg text-gray-600 max-w-3xl mx-auto" data-translate="guides.subtitle">
                    Познакомьтесь с нашей командой экспертов, которые сделают ваше путешествие по Центральной Азии незабываемым. 
                    Каждый из наших тургидов - профессионал с многолетним опытом и глубокими знаниями региона.
                </p>
            </div>

            <!-- Статистика -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
                <div class="text-center">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-semibold mb-2" data-translate="guides.licensed">Лицензированные гиды</h3>
                    <p class="text-gray-600" data-translate="guides.licensed_desc">Все наши гиды имеют официальные лицензии и сертификаты</p>
                </div>
                
                <div class="text-center">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-green-600" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M9 11H7v6h2v-6zm4 0h-2v6h2v-6zm4 0h-2v6h2v-6zm2.5-5H18V4c0-1.1-.9-2-2-2h-4c-1.1 0-2 .9-2 2v2H8.5C7.67 6 7 6.67 7 7.5S7.67 9 8.5 9H9v11c0 1.1.9 2 2 2h6c1.1 0 2-.9 2-2V9h.5c.83 0 1.5-.67 1.5-1.5S19.33 6 18.5 6zM14 4h-4v1h4V4z"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-semibold mb-2" data-translate="guides.clients">Более 1000 довольных клиентов</h3>
                    <p class="text-gray-600" data-translate="guides.clients_desc">Наши гиды провели тысячи успешных туров</p>
                </div>
                
                <div class="text-center">
                    <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-purple-600" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-semibold mb-2" data-translate="guides.multilingual">Мультиязычная поддержка</h3>
                    <p class="text-gray-600" data-translate="guides.multilingual_desc">Наши гиды говорят на множестве языков для вашего комфорта</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Секция загрузки -->
    <section id="loadingSection" class="py-16">
        <div class="container mx-auto px-6">
            <div class="text-center">
                <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"></div>
                <p class="text-gray-600" data-translate="guides.loading">Загружаем список тургидов...</p>
            </div>
        </div>
    </section>

    <!-- Секция с тургидами -->
    <section id="agentsSection" class="py-16 hidden">
        <div class="container mx-auto px-6">
            <div id="agentsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Карточки гидов будут добавлены динамически -->
            </div>
        </div>
    </section>

    <!-- Модальное окно найма гида -->
    <div id="hireModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white rounded-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 id="modalTitle" class="text-2xl font-bold text-gray-800" data-translate="guides.hire_guide">Нанять тургида</h2>
                    <button id="closeHireModal" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Календарь выбора дат -->
                    <div>
                        <h3 class="text-lg font-semibold mb-4" data-translate="guides.select_dates">Выберите даты</h3>
                        
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="flex justify-between items-center mb-4">
                                <button id="prevHireMonth" class="p-2 hover:bg-gray-200 rounded">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                    </svg>
                                </button>
                                <h4 id="hireMonthYear" class="text-lg font-semibold"></h4>
                                <button id="nextHireMonth" class="p-2 hover:bg-gray-200 rounded">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                    </svg>
                                </button>
                            </div>
                            
                            <div class="grid grid-cols-7 gap-1 mb-2">
                                <div class="text-center text-sm font-medium p-2" data-translate="calendar.mon">Пн</div>
                                <div class="text-center text-sm font-medium p-2" data-translate="calendar.tue">Вт</div>
                                <div class="text-center text-sm font-medium p-2" data-translate="calendar.wed">Ср</div>
                                <div class="text-center text-sm font-medium p-2" data-translate="calendar.thu">Чт</div>
                                <div class="text-center text-sm font-medium p-2" data-translate="calendar.fri">Пт</div>
                                <div class="text-center text-sm font-medium p-2" data-translate="calendar.sat">Сб</div>
                                <div class="text-center text-sm font-medium p-2" data-translate="calendar.sun">Вс</div>
                            </div>
                            
                            <div id="hireCalendarDays" class="grid grid-cols-7 gap-1">
                                <!-- Дни календаря будут добавлены динамически -->
                            </div>
                            
                            <div class="mt-4 flex flex-wrap gap-2 text-sm">
                                <div class="flex items-center">
                                    <div class="w-4 h-4 bg-blue-500 rounded mr-2"></div>
                                    <span data-translate="calendar.selected">Выбрано</span>
                                </div>
                                <div class="flex items-center">
                                    <div class="w-4 h-4 bg-green-500 rounded mr-2"></div>
                                    <span data-translate="calendar.available">Доступно</span>
                                </div>
                                <div class="flex items-center">
                                    <div class="w-4 h-4 bg-red-500 rounded mr-2"></div>
                                    <span data-translate="calendar.occupied">Занято</span>
                                </div>
                                <div class="flex items-center">
                                    <div class="w-4 h-4 bg-gray-300 rounded mr-2"></div>
                                    <span data-translate="calendar.unavailable">Недоступно</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Расчет стоимости и форма -->
                    <div>
                        <h3 class="text-lg font-semibold mb-4" data-translate="guides.cost_calculation">Расчет стоимости</h3>
                        
                        <div class="bg-gray-50 rounded-lg p-4 mb-6">
                            <div class="flex justify-between mb-2">
                                <span data-translate="guides.price_per_day">Цена за день:</span>
                                <span id="pricePerDay" class="font-semibold">300 TJS</span>
                            </div>
                            <div class="flex justify-between mb-2">
                                <span data-translate="guides.selected_days">Выбрано дней:</span>
                                <span id="selectedDaysCount" class="font-semibold">0</span>
                            </div>
                            <div class="border-t pt-2 mt-2">
                                <div class="flex justify-between text-lg font-bold">
                                    <span data-translate="guides.total">Итого:</span>
                                    <span id="totalPrice" class="text-blue-600">0 TJS</span>
                                </div>
                            </div>
                        </div>
                        
                        <h3 class="text-lg font-semibold mb-4" data-translate="guides.your_information">Ваша информация</h3>
                        
                        <form id="hireForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-translate="guides.your_name">Ваше имя *</label>
                                <input type="text" id="touristName" required 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                       data-translate-placeholder="guides.name_placeholder" placeholder="Введите ваше имя">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-translate="guides.email">Email *</label>
                                <input type="email" id="touristEmail" required 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                       data-translate-placeholder="guides.email_placeholder" placeholder="your@email.com">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-translate="guides.phone">Телефон</label>
                                <input type="tel" id="touristPhone" 
                                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                       data-translate-placeholder="guides.phone_placeholder" placeholder="+992 XX XXX XXXX">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2" data-translate="guides.comments">Комментарии</label>
                                <textarea id="hireComments" rows="3" 
                                          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                          data-translate-placeholder="guides.comments_placeholder" placeholder="Дополнительные пожелания или вопросы..."></textarea>
                            </div>
                            
                            <button type="submit" id="submitHire" disabled
                                    class="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white py-3 px-6 rounded-lg font-semibold transition-colors"
                                    data-translate="guides.submit_request">
                                Отправить заявку на найм
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Динамический контейнер для footer -->
    <div id="footer-container"></div>

    <!-- ИСПРАВЛЕНИЕ ПЕРЕВОДОВ - Минимальный функциональный скрипт -->
    <script>
        // РЕГИСТРИРУЕМ ОБРАБОТЧИК СМЕНЫ ЯЗЫКА НЕМЕДЛЕННО
        window.onLanguageChanged = function(newLang) {
            // Принудительно применяем переводы ко всем статическим элементам
            if (window.translateStaticInterface) {
                window.translateStaticInterface(newLang);
            }
            
            // Обновляем карточки гидов, если они загружены
            const agents = window.loadedAgents || [];
            const container = document.getElementById('agentsContainer');
            
            if (agents.length > 0 && container) {
                // Пересоздаем карточки с новым языком
                container.innerHTML = agents.map(agent => createGuideCard(agent, newLang)).join('');
            }
        };
        
        // Функция создания карточки гида с правильным языком
        function createGuideCard(agent, lang) {
            const currentLang = lang || window.currentLanguage || 'ru';
            
            // Получаем имя с учетом языка
            let name = 'Guide';
            if (agent.name) {
                if (typeof agent.name === 'object') {
                    name = agent.name[currentLang] || agent.name.ru || agent.name.en || 'Guide';
                } else {
                    name = agent.name;
                }
            }
            
            // Получаем языки
            let languages = ['Russian', 'English'];
            if (agent.languages) {
                if (Array.isArray(agent.languages)) {
                    languages = agent.languages;
                } else if (typeof agent.languages === 'string') {
                    try {
                        const parsed = JSON.parse(agent.languages);
                        languages = Array.isArray(parsed) ? parsed : [agent.languages];
                    } catch {
                        languages = [agent.languages];
                    }
                }
            }
            
            const avatar = agent.photoUrl ? `/uploads/guides/${agent.photoUrl.split('/').pop()}` : '/public/images/default-avatar.png';
            
            // Статические переводы
            const translations = {
                'ru': {
                    professionalGuide: 'Профессиональный гид',
                    languages: 'ЯЗЫКИ',
                    years: 'лет',
                    rating: 'рейтинг',
                    reviews: 'отзывы',
                    hireGuide: 'Нанять гида',
                    detailedInfo: 'Подробная информация'
                },
                'en': {
                    professionalGuide: 'Professional Guide',
                    languages: 'LANGUAGES',
                    years: 'years',
                    rating: 'rating',
                    reviews: 'reviews',
                    hireGuide: 'Hire Guide',
                    detailedInfo: 'Detailed Information'
                }
            };
            
            const t = translations[currentLang] || translations['en'];
            
            return `
                <div class="bg-white rounded-xl p-6 text-center shadow-md">
                    <div class="w-24 h-24 mx-auto mb-4 rounded-full overflow-hidden bg-blue-500 flex items-center justify-center text-white text-2xl font-bold">
                        ${agent.photoUrl ? 
                            `<img src="${avatar}" alt="${name}" class="w-full h-full object-cover">` :
                            name.split(' ').map(word => word[0]).join('').substring(0, 2).toUpperCase()
                        }
                    </div>
                    <div class="w-6 h-6 absolute top-4 right-4 text-gray-400 cursor-pointer">
                        <svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                    </div>
                    <h3 class="text-lg font-semibold mb-2">${name}</h3>
                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm mb-3 inline-block">${t.professionalGuide}</span>
                    
                    <div class="mb-4">
                        <p class="text-sm text-gray-600 mb-2">${t.languages}</p>
                        <div class="flex flex-wrap gap-2 justify-center">
                            ${languages.map(lang => 
                                `<span class="bg-gray-800 text-white px-2 py-1 rounded text-sm">${lang.trim()}</span>`
                            ).join('')}
                        </div>
                    </div>
                    
                    <div class="flex justify-between text-center mb-4">
                        <div>
                            <p class="text-2xl font-bold">${agent.experienceYears || 5}</p>
                            <p class="text-sm text-gray-600">${t.years}</p>
                        </div>
                        <div>
                            <p class="text-2xl font-bold">${agent.rating || 5}</p>
                            <p class="text-sm text-gray-600">${t.rating}</p>
                        </div>
                        <div>
                            <p class="text-2xl font-bold">${agent.reviewCount || 5}</p>
                            <p class="text-sm text-gray-600">${t.reviews}</p>
                        </div>
                    </div>
                    
                    <div class="space-y-2">
                        <button onclick="alert('${t.hireGuide}: ${name}')" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                            ${t.hireGuide}
                        </button>
                        <button onclick="alert('${t.detailedInfo}: ${name}')" class="w-full bg-gray-100 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-200 transition-colors">
                            ${t.detailedInfo}
                        </button>
                    </div>
                </div>
            `;
        }
        
        // Загрузка и отображение тургидов
        async function loadTourGuides() {
            try {
                const response = await fetch('/api/guides');
                const data = await response.json();
                
                if (data.success && Array.isArray(data.data)) {
                    window.loadedAgents = data.data;
                    const container = document.getElementById('agentsContainer');
                    const loadingSection = document.getElementById('loadingSection');
                    const agentsSection = document.getElementById('agentsSection');
                    
                    if (data.data.length === 0) {
                        container.innerHTML = `
                            <div class="col-span-full text-center py-12">
                                <div class="text-6xl mb-4">🧭</div>
                                <h3 class="text-xl font-semibold mb-2">Нет доступных гидов</h3>
                                <p class="text-gray-600">В данный момент нет зарегистрированных тургидов.</p>
                            </div>
                        `;
                    } else {
                        container.innerHTML = data.data.map(agent => createGuideCard(agent)).join('');
                    }
                    
                    loadingSection.classList.add('hidden');
                    agentsSection.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Ошибка загрузки тургидов:', error);
                const container = document.getElementById('agentsContainer');
                const loadingSection = document.getElementById('loadingSection');
                const agentsSection = document.getElementById('agentsSection');
                
                if (container) {
                    container.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <div class="text-6xl mb-4">⚠️</div>
                            <h3 class="text-xl font-semibold mb-2">Ошибка загрузки</h3>
                            <p class="text-gray-600">Не удалось загрузить список тургидов. Попробуйте обновить страницу.</p>
                        </div>
                    `;
                }
                
                if (loadingSection) loadingSection.classList.add('hidden');
                if (agentsSection) agentsSection.classList.remove('hidden');
            }
        }
        
        // Инициализация при загрузке DOM
        document.addEventListener('DOMContentLoaded', function() {
            loadTourGuides();
        });
    </script>
</body>
</html>